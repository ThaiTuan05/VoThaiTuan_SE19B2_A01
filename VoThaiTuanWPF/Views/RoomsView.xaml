<UserControl x:Class="VoThaiTuanWPF.Views.RoomsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:VoThaiTuanWPF.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Style="{StaticResource Card}" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         Style="{StaticResource ToolbarTextBox}"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         TextChanged="SearchTextBox_TextChanged"/>

                <Button Grid.Column="1"
                        Content="Add Room"
                        Style="{StaticResource ToolbarButton}"
                        Background="{DynamicResource SuccessBrush}"
                        Foreground="White"
                        Command="{Binding AddRoomCommand}"/>

                <Button Grid.Column="2"
                        Content="Refresh"
                        Style="{StaticResource ToolbarButton}"
                        Background="{DynamicResource PrimaryBrush}"
                        Foreground="White"
                        Margin="10,0,0,0"
                        Command="{Binding RefreshCommand}"/>
            </Grid>
        </Border>

        <!-- Data Grid -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="420"/>
                </Grid.ColumnDefinitions>

                <DataGrid Grid.Column="0"
                          AutoGenerateColumns="False"
                      ItemsSource="{Binding Rooms}"
                      SelectedItem="{Binding SelectedRoom}"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserSortColumns="True"
                      IsReadOnly="True"
                      RowHeight="36"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column">
                <DataGrid.Resources>
                    <Style x:Key="CenterCell" TargetType="TextBlock">
                        <Setter Property="HorizontalAlignment" Value="Center"/>
                        <Setter Property="TextAlignment" Value="Center"/>
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding RoomID}" Width="60" ElementStyle="{StaticResource CenterCell}"/>
                    <DataGridTextColumn Header="Number" Binding="{Binding RoomNumber}" Width="100" ElementStyle="{StaticResource CenterCell}"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding RoomType.RoomTypeName}" Width="*"/>
                    <DataGridTextColumn Header="Capacity" Binding="{Binding RoomMaxCapacity}" Width="100" ElementStyle="{StaticResource CenterCell}"/>
                    <DataGridTextColumn Header="Price/Day" Binding="{Binding RoomPricePerDay, StringFormat=\{0:N0\}}" Width="140" ElementStyle="{StaticResource CenterCell}"/>
                    <DataGridTemplateColumn Header="Actions" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="Edit"
                                            Background="{DynamicResource WarningBrush}"
                                            Style="{StaticResource ActionButton}"
                                            Margin="0,0,8,0"
                                            Command="{Binding DataContext.EditRoomCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"/>
                                    <Button Content="Delete"
                                            Background="{DynamicResource DangerBrush}"
                                            Style="{StaticResource ActionButton}"
                                            Command="{Binding DataContext.DeleteRoomCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
                </DataGrid>

                <!-- Inline Editor Panel -->
                <Border Grid.Column="1" Margin="10,0,0,0" Background="White" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" Padding="16"
                        Visibility="{Binding IsEditorOpen, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="{Binding EditorTitle}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>

                        <StackPanel Grid.Row="1" Margin="0,12,0,12">
                            <TextBlock Text="Room Number" FontSize="12" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding EditingRoom.RoomNumber, UpdateSourceTrigger=PropertyChanged}" Height="32"/>

                            <TextBlock Text="Room Type" Margin="0,10,0,0" FontSize="12" FontWeight="SemiBold"/>
                            <ComboBox ItemsSource="{Binding RoomTypes}"
                                      DisplayMemberPath="RoomTypeName"
                                      SelectedValuePath="RoomTypeID"
                                      SelectedValue="{Binding EditingRoom.RoomTypeID}"
                                      Height="32"/>

                            <TextBlock Text="Description" Margin="0,10,0,0" FontSize="12" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding EditingRoom.RoomDetailDescription, UpdateSourceTrigger=PropertyChanged}" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>

                            <TextBlock Text="Capacity" Margin="0,10,0,0" FontSize="12" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding EditingRoom.RoomMaxCapacity, UpdateSourceTrigger=PropertyChanged}" Height="32"/>

                            <TextBlock Text="Price/Day" Margin="0,10,0,0" FontSize="12" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding EditingRoom.RoomPricePerDay, UpdateSourceTrigger=PropertyChanged}" Height="32"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Save" Background="{StaticResource SuccessBrush}" Foreground="White" Style="{StaticResource ActionButton}" Margin="0,0,8,0" Command="{Binding SaveRoomCommand}"/>
                            <Button Content="Cancel" Background="{StaticResource DangerBrush}" Foreground="White" Style="{StaticResource ActionButton}" Command="{Binding CancelEditCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Footer / Status -->
        <Border Grid.Row="2" Background="#F0F0F0" Padding="10">
            <TextBlock FontSize="12"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource MutedTextBrush}"
                       Text="{Binding StatusText}"/>
        </Border>
    </Grid>
</UserControl>


